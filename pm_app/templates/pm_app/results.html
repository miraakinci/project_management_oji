{% extends 'base.html' %}

{% block content %}
<h1 class="mb-4">Project Plan & Timeline</h1>

<div class="flow-container text-center mb-5">
    <div class="card flow-card flex-fill">
        <h5 class="card-title">Vision</h5>
        <p>{{ project.vision }}</p>
    </div>
    <div class="flow-arrow">&rarr;</div>
    <div class="card flow-card flex-fill">
        <h5 class="card-title">Outcomes</h5>
        {% for item in project.outcomes.all %}
            <p>{{ item.description }}</p>
        {% endfor %}
    </div>
    <div class="flow-arrow">&rarr;</div>
    <div class="card flow-card flex-fill">
        <h5 class="card-title">Benefits</h5>
        {% for item in project.benefits.all %}
             <p>{{ item.description }}</p>
        {% endfor %}
    </div>
     <div class="flow-arrow">&rarr;</div>
    <div class="card flow-card flex-fill">
        <h5 class="card-title">Deliverables</h5>
        {% for item in project.deliverables.all %}
             <p>{{ item.description }}</p>
        {% endfor %}
    </div>
</div>

<h2 class="mb-3">Project Timeline</h2>
<div id="gantt-chart">
    <svg id="gantt"></svg>
</div>

{{ chart_data|json_script:"chart-data" }}

<script src="https://cdn.jsdelivr.net/npm/frappe-gantt/dist/frappe-gantt.min.js"></script>
<script>
    const chartData = JSON.parse(document.getElementById('chart-data').textContent);
    
    if (chartData.length > 0) {
        var gantt = new Gantt("#gantt", chartData, {
            view_mode: 'Month', // Quarter Day, Half Day, Day, Week, Month
            date_format: 'YYYY-MM-DD',
            custom_popup_html: function(task) {
                return `
                    <div class="details-container" style="padding:10px;">
                        <h5>${task.name}</h5>
                        <p>Started: ${task._start.toLocaleDateString()}</p>
                        <p>Ending: ${task._end.toLocaleDateString()}</p>
                        <p>${task.progress}% completed!</p>
                    </div>
                `;
            }
        });
    } else {
        document.getElementById('gantt-chart').innerHTML = '<p class="text-muted">No tasks have been generated for this project yet.</p>';
    }
</script>
{% endblock %}